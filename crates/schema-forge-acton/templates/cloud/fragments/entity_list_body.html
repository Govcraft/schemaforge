{% if filter_fields %}
<div class="sf-filters">
    {% for filter in filter_fields %}
    <div class="sf-filter-group">
        <span class="sf-filter-label">{{ filter.label }}:</span>
        <a class="sf-filter-pill{% if filter.all_active %} sf-filter-pill-active{% endif %}"
           hx-get="/app/{{ schema.url_name }}/entities/_table?{% for f2 in filter_fields %}{% if not f2.all_active and f2.active_value %}{% if f2.name != filter.name %}filter_{{ f2.name }}={{ f2.active_value }}&{% endif %}{% endif %}{% endfor %}"
           hx-target="#sf-entity-table" hx-swap="innerHTML" hx-push-url="true">All</a>
        {% for pill in filter.pills %}
        <a class="sf-filter-pill{% if pill.is_active %} sf-filter-pill-active{% endif %}"
           hx-get="/app/{{ schema.url_name }}/entities/_table?filter_{{ filter.name }}={{ pill.value }}{% for f2 in filter_fields %}{% if not f2.all_active and f2.active_value %}{% if f2.name != filter.name %}&filter_{{ f2.name }}={{ f2.active_value }}{% endif %}{% endif %}{% endfor %}"
           hx-target="#sf-entity-table" hx-swap="innerHTML" hx-push-url="true">{{ pill.value }}</a>
        {% endfor %}
    </div>
    {% endfor %}
</div>
{% endif %}
{% if not entities %}
<div class="sf-empty">
    <p>No entities yet.</p>
    <a href="/app/{{ schema.url_name }}/entities/new" class="sf-btn sf-btn-primary">Create First Entity</a>
</div>
{% else %}
{% if list_style == "table" %}
<div class="sf-entity-list" data-list-style="table">
    <div class="sf-list-header">
        {% for field in schema.fields %}
        <div class="sf-list-header-cell">{{ field.label }}</div>
        {% endfor %}
        <div class="sf-list-header-cell">Actions</div>
    </div>
    {% for entity in entities %}
    <div class="sf-list-row" id="sf-entity-{{ entity.id }}">
        {% for field in entity.field_values %}
        <div class="sf-list-cell">{% if field.is_empty %}<span class="sf-detail-value" style="opacity: 0.4">-</span>{% else %}{% include "cloud/atoms/field_display.html" %}{% endif %}</div>
        {% endfor %}
        <div class="sf-list-cell">
            <a href="/app/{{ schema.url_name }}/entities/{{ entity.id }}" class="sf-btn sf-btn-secondary sf-btn-sm">View</a>
            <a href="/app/{{ schema.url_name }}/entities/{{ entity.id }}/edit" class="sf-btn sf-btn-secondary sf-btn-sm">Edit</a>
            <button class="sf-btn sf-btn-danger sf-btn-sm"
                hx-delete="/app/{{ schema.url_name }}/entities/{{ entity.id }}"
                hx-confirm="Delete this entity?"
                hx-target="#sf-entity-{{ entity.id }}"
                hx-swap="delete"
            >Del</button>
        </div>
    </div>
    {% endfor %}
</div>
{% elif list_style == "cards" %}
<div class="sf-entity-list" data-list-style="cards">
    {% for entity in entities %}
    <div class="sf-card" id="sf-entity-{{ entity.id }}">
        <a href="/app/{{ schema.url_name }}/entities/{{ entity.id }}" class="sf-card-title">{{ entity.display_value }}</a>
        {% for field in entity.summary %}
        <div class="sf-card-field">
            <span class="sf-card-label">{{ field.label }}</span>
            <span>{% include "cloud/atoms/field_display.html" %}</span>
        </div>
        {% endfor %}
        <div style="margin-top: 0.5rem;">
            <a href="/app/{{ schema.url_name }}/entities/{{ entity.id }}/edit" class="sf-btn sf-btn-secondary sf-btn-sm">Edit</a>
            <button class="sf-btn sf-btn-danger sf-btn-sm"
                hx-delete="/app/{{ schema.url_name }}/entities/{{ entity.id }}"
                hx-confirm="Delete this entity?"
                hx-target="#sf-entity-{{ entity.id }}"
                hx-swap="delete"
            >Del</button>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="sf-entity-list" data-list-style="compact">
    {% for entity in entities %}
    <div class="sf-list-row" id="sf-entity-{{ entity.id }}">
        <a href="/app/{{ schema.url_name }}/entities/{{ entity.id }}">{{ entity.display_value }}</a>
        <span style="flex: 1;"></span>
        <a href="/app/{{ schema.url_name }}/entities/{{ entity.id }}/edit" class="sf-btn sf-btn-secondary sf-btn-xs">Edit</a>
        <button class="sf-btn sf-btn-danger sf-btn-xs"
            hx-delete="/app/{{ schema.url_name }}/entities/{{ entity.id }}"
            hx-confirm="Delete this entity?"
            hx-target="#sf-entity-{{ entity.id }}"
            hx-swap="delete"
        >Del</button>
    </div>
    {% endfor %}
</div>
{% endif %}
<div class="sf-pagination">
    <span class="sf-pagination-info">
        Showing {{ pagination.offset + 1 }}-{{ pagination.end_showing }}
        of {{ pagination.total_count }}
    </span>
    <div>
        {% if pagination.has_previous %}
        <a href="#" class="sf-btn sf-btn-secondary sf-btn-sm"
           hx-get="/app/{{ schema.url_name }}/entities/_table?limit={{ pagination.limit }}&offset={{ pagination.previous_offset }}{% for f in filter_fields %}{% if f.active_value %}&filter_{{ f.name }}={{ f.active_value }}{% endif %}{% endfor %}"
           hx-target="#sf-entity-table"
           hx-swap="innerHTML"
        >Previous</a>
        {% endif %}
        {% if pagination.has_next %}
        <a href="#" class="sf-btn sf-btn-secondary sf-btn-sm"
           hx-get="/app/{{ schema.url_name }}/entities/_table?limit={{ pagination.limit }}&offset={{ pagination.next_offset }}{% for f in filter_fields %}{% if f.active_value %}&filter_{{ f.name }}={{ f.active_value }}{% endif %}{% endfor %}"
           hx-target="#sf-entity-table"
           hx-swap="innerHTML"
        >Next</a>
        {% endif %}
    </div>
</div>
{% endif %}
